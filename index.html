<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
        <title>Genshin Craft</title>
    </head>
    <body>
        <!-- 돌파 버튼 시작 -->
        <div class="container my-3 mt-5">
            <div class="row">
                <div class="col">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="currentCk" />
                        <label class="form-check-label" for="flexCheckDefault"> 돌파</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="aimCk" />
                        <label class="form-check-label" for="flexCheckDefault" checked> 돌파</label>
                    </div>
                </div>
            </div>
        </div>
        <!-- 돌파 버튼 끝 -->
        <!-- 입력창 시작 -->
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="form-floating mb-3">
                        <input
                            type="number"
                            id="currentLv"
                            class="form-control"
                            placeholder="현재 레벨"
                            value=""
                        />
                        <label for="floatingInput1"> 현재 레벨</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-floating mb-3 col">
                        <input
                            type="number"
                            id="aimLv"
                            class="form-control"
                            placeholder="목표 레벨"
                            value="90"
                        />
                        <label for="floatingInput2" class="col"> 목표 레벨</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="form-floating mb-3">
                        <input
                            id="star_5"
                            type="number"
                            class="form-control"
                        />
                        <label for="floatingInput1">5성</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-floating mb-3">
                        <input
                            id="star_4"
                            type="number"
                            class="form-control"
                        />
                        <label for="floatingInput1">4성</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-floating mb-3">
                        <input
                            id="star_3"
                            type="number"
                            class="form-control"
                        />
                        <label for="floatingInput1">3성</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-floating mb-3 col">
                        <input
                            id="star_2"
                            type="number"
                            class="form-control"
                            onkeyup="if(window.event.keyCode==13){render();
                            this.blur()}"
                        />
                        <label for="floatingInput2" class="col">2성</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="container mt-2">
            <button class="btn btn-outline-primary w-100" data-bs-toggle="modal" data-bs-target="#exampleModal" id="calcBtn">Calculate</button>
        </div>
        <!-- 입력창 끝 -->
        <!-- 결과창 시작 -->
        <hr />
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="alert alert-success fw-bold" id="requiredTotal" role="alert">
          </div>
        </div>
      </div>

        <div class="container my-5" style="border-radius: 5px">
            <table class="table table-white">
                <thead>
                    <tr style="text-align: center">
                        <th width="40%">합성</th>
                        <th width="15%" scope="col" style="color: black">5&lt;-4</th>
                        <th width="15%" scope="col" style="color: black">4&lt;-3</th>
                        <th width="15%" scope="col" style="color: black">3&lt;-2</th>
                    </tr>
                </thead>
                <tr style="text-align: center">
                    <th width="40%">횟수</th>
                    <th width="15%" id="count_4_5" scope="col" style="color: black"></th>
                    <th width="15%" id="count_3_4" scope="col" style="color: black"></th>
                    <th width="15%" id="count_2_3" scope="col" style="color: black"></th>
                </tr>
                <tfoot>
                    <tr style="text-align: center">
                        <th width="40%" id="moraTotal" scope="col" style="color: black">비용</th>
                        <th width="15%" id="mora_4_5" scope="col" style="color: black"></th>
                        <th width="15%" id="mora_3_4" scope="col" style="color: black"></th>
                        <th width="15%" id="mora_2_3" scope="col" style="color: black"></th>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="container my-5" style="border-radius: 5px">
            <table class="table table-white">
                <tr style="text-align: center">
                    <th width="40%" rowspan="2">남은 재화</th>
                    <th width="15%" id="result_5" scope="col" style="color: black; background-color: #ffe866"></th>
                    <th width="15%" id="result_4" scope="col" style="color: black; background-color: #c29cd6"></th>
                    <th width="15%" id="result_3" scope="col" style="color: black; background-color: #9fb3e6"></th>
                    <th width="15%" id="result_2" scope="col" style="color: black; background-color: #68d9ac"></th>
                </tr>
            </table>
        </div>

        <div class="container my-5" style="border-radius: 5px">
            <table class="table table-white">
                <tr style="text-align: center">
                    <th width="40%" rowspan="2">추가 필요 재화</th>
                    <th width="15%" id="remain_5" scope="col" style="color: black; background-color: #ffe866"></th>
                    <th width="15%" id="remain_4" scope="col" style="color: black; background-color: #c29cd6"></th>
                    <th width="15%" id="remain_3" scope="col" style="color: black; background-color: #9fb3e6"></th>
                    <th width="15%" id="remain_2" scope="col" style="color: black; background-color: #68d9ac"></th>
                </tr>
            </table>
        </div>
        <!-- 결과창 끝 -->
    </body>
    <script src="https://genshin-craft.github.io/craftify.js"></script>
    <script>
        // 필드 선언 시작
        var cc = document.querySelector('#currentCk');
        var ac = document.querySelector('#aimCk');

        var cl = document.querySelector('#currentLv');
        var al = document.querySelector('#aimLv');

        var star5 = document.querySelector('#star_5');
        var star4 = document.querySelector('#star_4');
        var star3 = document.querySelector('#star_3');
        var star2 = document.querySelector('#star_2');

        var r5 = document.querySelector('#result_5');
        var r4 = document.querySelector('#result_4');
        var r3 = document.querySelector('#result_3');
        var r2 = document.querySelector('#result_2');
        
        var rm5 = document.querySelector('#remain_5');
        var rm4 = document.querySelector('#remain_4');
        var rm3 = document.querySelector('#remain_3');
        var rm2 = document.querySelector('#remain_2');

        const c5 = document.getElementById("count_4_5");
        const c4 = document.getElementById("count_3_4");
        const c3 = document.getElementById("count_2_3");
        
        const m5 = document.getElementById("mora_4_5");
        const m4 = document.getElementById("mora_3_4");
        const m3 = document.getElementById("mora_2_3");

        const rt = document.getElementById("requiredTotal");
        
        const mt = document.getElementById("moraTotal");

        var Btn = document.querySelector('#calcBtn');
        var requiredTotal = 0;
        // 필드 선언 끝

        // 계산하기 버튼 클릭
        var total = [0, 0, 0, 0];
        var origin = [0, 0, 0, 0];

        function render() {
            total = totalCalc(al, ac);
            origin = totalCalc(cl, cc);
            const possessArr = [star5.value, star4.value, star3.value, star2.value];
            const targetArr = [total[0] - origin[0], 
                               total[1] - origin[1], 
                               total[2] - origin[2], 
                               total[3] - origin[3]];
            const result = craftify(possessArr, targetArr);

            r5.innerText = result.remain[0];
            r4.innerText = result.remain[1];
            r3.innerText = result.remain[2];
            r2.innerText = result.remain[3];

            rm5.innerText = result.required[0];
            rm4.innerText = result.required[1];
            rm3.innerText = result.required[2];
            rm2.innerText = result.required[3];
            requiredTotal = mxm((result.required[0] * 27 + result.required[1] * 9 + result.required[2] * 3 + result.required[3])
                          -(result.remain[0] * 27 + result.remain[1] * 9 + result.remain[2] * 3 + result.remain[3]),0)

            if (requiredTotal > 0 ) rt.innerText = `총 ${requiredTotal}개의 가루가 추가로 필요합니다`;
            else rt.innerText = `재료를 모두 모았습니다!`;
            
            c5.innerText = result.count[0];
            c4.innerText = result.count[1];
            c3.innerText = result.count[2];

            m5.innerText = result.count[0] * 2700;
            m4.innerText = result.count[1] * 900;
            m3.innerText = result.count[2] * 300;
            
            mt.innerText = `총 ${result.count[0] * 2700 + result.count[1] * 900 + result.count[2] * 300} 모라`;
        }
        Btn.addEventListener('click', () => {
            render();
        });

        star2.addEventListener('enter', () => {
            render();
        });
        function mxm(a) {
          return Math.max(a,0);
        } 
        function totalCalc(a, c) {
            if (a.value > 80 || (a.value == 80 && c.checked)) return [6, 9, 9, 1];
            else if (a.value > 70 || (a.value == 70 && c.checked)) return [0, 9, 9, 1];
            else if (a.value > 60 || (a.value == 60 && c.checked)) return [0, 3, 9, 1];
            else if (a.value > 50 || (a.value == 50 && c.checked)) return [0, 0, 9, 1];
            else if (a.value > 40 || (a.value == 40 && c.checked)) return [0, 0, 3, 1];
            else if (a.value > 20 || (a.value == 20 && c.checked)) return [0, 0, 0, 1];
            else return [0, 0, 0, 0];
        }

    </script>
</html>
