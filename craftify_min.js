function craftify($,_){return 4===$.length&&4===_.length?fu([mx($[0]-_[0],0),mx($[1]-_[1],0),mx($[2]-_[2],0),mx($[3]-_[3],0)],[mx(_[0]-$[0],0),mx(_[1]-$[1],0),mx(_[2]-$[2],0),mx(_[3]-$[3],0),]):fu([mx($[0]-_[0],0),mx($[1]-_[1],0),mx($[2]-_[2],0),0],[mx(_[0]-$[0],0),mx(_[1]-$[1],0),mx(_[2]-$[2],0),0])}function fu($,_){let t=0,r=[0,0,0,0],e=[0,0,0,0],n=[0,0,0];e[3]=_[3],e[2]=_[2],e[1]=_[1],e[0]=tC($[1],_[0],3),_[0]-f($[1]/3)>=0?n[0]=f($[1]/3):n[0]=_[0],r[3]=$[3],r[2]=$[2],r[1]=rC($[1],_[0],3),r[0]=$[0];let u=[0,0,0,0],m=[0,0,0,0],x=[0,0,0];m[3]=e[3],m[2]=e[2],m[1]=tC(r[2],e[1],3),m[0]=e[0],e[1]-f(r[2]/3)>=0?x[1]=f(r[2]/3):x[1]=e[1],u[3]=r[3],u[2]=rC(r[2],e[1],3),u[1]=r[1],u[0]=r[0];var l=[0,0,0];e[3]=m[3],e[2]=m[2],e[1]=m[1],e[0]=tC(u[2],m[0],9),m[0]-f(u[2]/9)>=0?l[1]=3*f(u[2]/9):l[1]=3*m[0],l[0]=l[1]/3,r[3]=u[3],r[2]=rC(u[2],m[0],9),r[1]=u[1],r[0]=u[0];let o=[0,0,0];m[3]=e[3],m[2]=tC(r[3],e[2],3),m[1]=e[1],m[0]=e[0],e[2]-f(r[3]/3)>=0?o[2]=f(r[3]/3):o[2]=e[2],u[3]=rC(r[3],e[2],3),u[2]=r[2],u[1]=r[1],u[0]=r[0];let C=[0,0,0];e[3]=m[3],e[2]=m[2],e[1]=tC(u[3],m[1],9),e[0]=m[0],m[1]-f(u[3]/9)>=0?C[2]=3*f(u[3]/9):C[2]=3*m[1],C[1]=C[2]/3,r[3]=rC(u[3],m[1],9),r[2]=u[2],r[1]=u[1],r[0]=u[0];let i=[0,0,0];m[3]=e[3],m[2]=e[2],m[1]=e[1],m[0]=tC(r[3],e[0],27),e[0]-f(r[3]/27)>=0?i[2]=9*f(r[3]/27):i[2]=9*e[0],u[3]=rC(r[3],e[0],27),u[2]=r[2],u[1]=r[1],u[0]=r[0],i[1]=i[2]/3,i[0]=i[1]/3;let c=[0,0,0];e[3]=m[3],e[2]=m[2],e[1]=m[1],0==m[0]?e[0]=0:u[2]<9&&u[1]<3&&3*u[1]+u[2]>=9?e[0]=m[0]-1:e[0]=m[0],m[0]-e[0]==1?c[1]=3-u[1]:c[1]=0,m[0]-e[0]==1?c[0]=1:c[0]=0,r[3]=u[3],m[0]-e[0]==1?r[2]=u[2]-3*c[1]:r[2]=u[2],m[0]-e[0]==1?r[1]=0:r[1]=u[1],r[0]=u[0];let a=[0,0,0];m[3]=e[3],m[2]=e[2],m[1]=e[1],0==e[0]?m[0]=0:r[3]<27&&r[2]<9&&3*r[2]+r[3]>=27?m[0]=e[0]-1:m[0]=e[0],e[0]-m[0]==1?a[2]=9-r[2]:a[2]=0,e[0]-m[0]==1?a[0]=1:a[0]=0,1==a[0]?a[1]=3:a[1]=0,e[0]-m[0]==1?u[3]=r[3]-3*a[2]:u[3]=r[3],e[0]-m[0]==1?u[2]=0:u[2]=r[2],u[1]=r[1],u[0]=r[0];let g=[0,0,0];e[3]=m[3],e[2]=m[2],e[1]=m[1],0==m[0]?e[0]=0:u[3]<27&&u[1]<3&&9*u[1]+u[3]>=27?e[0]=m[0]-1:e[0]=m[0],m[0]-e[0]==1?g[0]=1:g[0]=0,m[0]-e[0]==1?g[1]=3-u[1]:g[1]=0,m[0]-e[0]==1?r[3]=u[3]-9*g[1]:r[3]=u[3],g[2]=(u[3]-r[3])/3,r[2]=u[2],m[0]-e[0]==1&&(r[1]=0),r[1]=u[1],r[0]=u[0];let h=[0,0,0];m[3]=e[3],m[2]=e[2],0==e[1]?m[1]=0:r[3]<9&&r[2]<3&&3*r[2]+r[3]>=9?m[1]=e[1]-1:m[1]=e[1],m[0]=e[0],e[1]-m[1]==1?h[2]=3-r[2]:h[2]=0,1==e[1]?h[1]=1:h[1]=0,e[1]-m[1]==1?u[3]=r[3]-3*h[2]:u[3]=r[3],e[1]-m[1]==1?u[2]=0:u[2]=r[2],u[1]=r[1],u[0]=r[0];let d=[0,0,0];e[3]=m[3],e[2]=m[2],e[1]=m[1],0==m[0]?e[0]=0:u[3]<27&&u[2]<9&&u[1]<3&&9*u[1]+3*u[1]+u[3]>=27?e[0]=m[0]-1:e[0]=m[0],m[0]-e[0]==1?1==u[1]?d[2]=6-u[2]:2==u[1]?d[2]=3-u[2]:console.log("fusion count error!"):d[2]=0,m[0]-e[0]==1?d[0]=1:d[0]=0,m[0]-e[0]==1?d[1]=3-u[1]:d[1]=0,m[0]-e[0]==1?r[3]=u[3]-3*d[2]:r[3]=u[3],m[0]-e[0]==1?r[2]=0:r[2]=u[2],m[0]-e[0]==1?r[1]=0:r[1]=u[1],r[0]=u[0];let q=0,s=0,v=0;return[n,x,l,o,C,i,c,a,g,h,d,].forEach($=>{q+=$[0],s+=$[1],v+=$[2]}),t=0!==e[0]?27*e[0]+9*e[1]+3*e[2]+e[3]-(27*r[0]+9*r[1]+3*r[2]+r[3]):0!==e[1]?9*e[1]+3*e[2]+e[3]-(9*r[1]+3*r[2]+r[3]):0!==e[2]?3*e[2]+e[3]-(3*r[2]+r[3]):mx(e[3]-r[3],0),{required:[e[0],e[1],e[2],e[3]],requiredTotal:t,remain:[r[0],r[1],r[2],r[3]],count:[q,s,v]}}function f($){return Math.floor($)}function mx($){return Math.max($,0)}function rC($,_,t){return _-f($/t)>=0?$-f($/t)*t:(f($/t)-_)*t+$-f($/t)*t}function tC($,_,t){return _-f($/t)>=0?_-f($/t):0}
