function craftify($,_){function r($){return Math.max($,0)}return 4===$.length&&4===_.length?fu([r($[0]-_[0],0),r($[1]-_[1],0),r($[2]-_[2],0),r($[3]-_[3],0)],[r(_[0]-$[0],0),r(_[1]-$[1],0),r(_[2]-$[2],0),r(_[3]-$[3],0),]):fu([r($[0]-_[0],0),r($[1]-_[1],0),r($[2]-_[2],0),0],[r(_[0]-$[0],0),r(_[1]-$[1],0),r(_[2]-$[2],0),0])}function fu($,_){let r=0,t=[0,0,0,0],l=[0,0,0,0],f=[0,0,0];l[3]=_[3],l[2]=_[2],l[1]=_[1],l[0]=tC($[1],_[0],3),_[0]-flr($[1]/3)>=0?f[0]=flr($[1]/3):f[0]=_[0],t[3]=$[3],t[2]=$[2],t[1]=rC($[1],_[0],3),t[0]=$[0];let e=[0,0,0,0],n=[0,0,0,0],u=[0,0,0];n[3]=l[3],n[2]=l[2],n[1]=tC(t[2],l[1],3),n[0]=l[0],l[1]-flr(t[2]/3)>=0?u[1]=flr(t[2]/3):u[1]=l[1],e[3]=t[3],e[2]=rC(t[2],l[1],3),e[1]=t[1],e[0]=t[0];var o=[0,0,0];l[3]=n[3],l[2]=n[2],l[1]=n[1],l[0]=tC(e[2],n[0],9),n[0]-flr(e[2]/9)>=0?o[1]=3*flr(e[2]/9):o[1]=3*n[0],o[0]=o[1]/3,t[3]=e[3],t[2]=rC(e[2],n[0],9),t[1]=e[1],t[0]=e[0];let C=[0,0,0];n[3]=l[3],n[2]=tC(t[3],l[2],3),n[1]=l[1],n[0]=l[0],l[2]-flr(t[3]/3)>=0?C[2]=flr(t[3]/3):C[2]=l[2],e[3]=rC(t[3],l[2],3),e[2]=t[2],e[1]=t[1],e[0]=t[0];let i=[0,0,0];l[3]=n[3],l[2]=n[2],l[1]=tC(e[3],n[1],9),l[0]=n[0],n[1]-flr(e[3]/9)>=0?i[2]=3*flr(e[3]/9):i[2]=3*n[1],i[1]=i[2]/3,t[3]=rC(e[3],n[1],9),t[2]=e[2],t[1]=e[1],t[0]=e[0];let c=[0,0,0];n[3]=l[3],n[2]=l[2],n[1]=l[1],n[0]=tC(t[3],l[0],27),l[0]-flr(t[3]/27)>=0?c[2]=9*flr(t[3]/27):c[2]=9*l[0],e[3]=rC(t[3],l[0],27),e[2]=t[2],e[1]=t[1],e[0]=t[0],c[1]=c[2]/3,c[0]=c[1]/3;let a=[0,0,0];l[3]=n[3],l[2]=n[2],l[1]=n[1],0==n[0]?l[0]=0:e[2]<9&&e[1]<3&&3*e[1]+e[2]>=9?l[0]=n[0]-1:l[0]=n[0],n[0]-l[0]==1?a[1]=3-e[1]:a[1]=0,n[0]-l[0]==1?a[0]=1:a[0]=0,t[3]=e[3],n[0]-l[0]==1?t[2]=e[2]-3*a[1]:t[2]=e[2],n[0]-l[0]==1?t[1]=0:t[1]=e[1],t[0]=e[0];let g=[0,0,0];n[3]=l[3],n[2]=l[2],n[1]=l[1],0==l[0]?n[0]=0:t[3]<27&&t[2]<9&&3*t[2]+t[3]>=27?n[0]=l[0]-1:n[0]=l[0],l[0]-n[0]==1?g[2]=9-t[2]:g[2]=0,l[0]-n[0]==1?g[0]=1:g[0]=0,1==g[0]?g[1]=3:g[1]=0,l[0]-n[0]==1?e[3]=t[3]-3*g[2]:e[3]=t[3],l[0]-n[0]==1?e[2]=0:e[2]=t[2],e[1]=t[1],e[0]=t[0];let h=[0,0,0];l[3]=n[3],l[2]=n[2],l[1]=n[1],0==n[0]?l[0]=0:e[3]<27&&e[1]<3&&9*e[1]+e[3]>=27?l[0]=n[0]-1:l[0]=n[0],n[0]-l[0]==1?h[0]=1:h[0]=0,n[0]-l[0]==1?h[1]=3-e[1]:h[1]=0,n[0]-l[0]==1?t[3]=e[3]-9*h[1]:t[3]=e[3],h[2]=(e[3]-t[3])/3,t[2]=e[2],n[0]-l[0]==1&&(t[1]=0),t[1]=e[1],t[0]=e[0];let d=[0,0,0];n[3]=l[3],n[2]=l[2],0==l[1]?n[1]=0:t[3]<9&&t[2]<3&&3*t[2]+t[3]>=9?n[1]=l[1]-1:n[1]=l[1],n[0]=l[0],l[1]-n[1]==1?d[2]=3-t[2]:d[2]=0,1==l[1]?d[1]=1:d[1]=0,l[1]-n[1]==1?e[3]=t[3]-3*d[2]:e[3]=t[3],l[1]-n[1]==1?e[2]=0:e[2]=t[2],e[1]=t[1],e[0]=t[0];let m=[0,0,0];l[3]=n[3],l[2]=n[2],l[1]=n[1],0==n[0]?l[0]=0:e[3]<27&&e[2]<9&&e[1]<3&&9*e[1]+3*e[1]+e[3]>=27?l[0]=n[0]-1:l[0]=n[0],n[0]-l[0]==1?1==e[1]?m[2]=6-e[2]:2==e[1]?m[2]=3-e[2]:console.log("fusion count error!"):m[2]=0,n[0]-l[0]==1?m[0]=1:m[0]=0,n[0]-l[0]==1?m[1]=3-e[1]:m[1]=0,n[0]-l[0]==1?t[3]=e[3]-3*m[2]:t[3]=e[3],n[0]-l[0]==1?t[2]=0:t[2]=e[2],n[0]-l[0]==1?t[1]=0:t[1]=e[1],t[0]=e[0];let q=0,s=0,v=0;return[f,u,o,C,i,c,a,g,h,d,m,].forEach($=>{q+=$[0],s+=$[1],v+=$[2]}),r=0!==l[0]?27*l[0]+9*l[1]+3*l[2]+l[3]-(27*t[0]+9*t[1]+3*t[2]+t[3]):0!==l[1]?9*l[1]+3*l[2]+l[3]-(9*t[1]+3*t[2]+t[3]):0!==l[2]?3*l[2]+l[3]-(3*t[2]+t[3]):1,{required:[l[0],l[1],l[2],l[3]],requiredTotal:r,remain:[t[0],t[1],t[2],t[3]],count:[q,s,v]}}function flr($){return Math.floor($)}function rC($,_,r){return _-flr($/r)>=0?$-flr($/r)*r:(flr($/r)-_)*r+$-flr($/r)*r}function tC($,_,r){return _-flr($/r)>=0?_-flr($/r):0}
